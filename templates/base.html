<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Website - SQLite Form</title>
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
     <!-- Tom Select (searchable select) - local -->
     <link href="{{ url_for('static', filename='lib/tom-select.min.css') }}" rel="stylesheet">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pVn+XQ8m8Q2s3qJw5q2a2x0eVqVq8Yv1QYfQb1E1q2Q1Vn1w5c6Qe2s7W9K1q3G+0V1bQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      /* layout container */
      :root{
        --accent:#2563eb;
        --muted:#6b7280;
        --card-bg:#ffffff;
        --surface:#f8fafc;
      }
      body{ 
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; 
        background:var(--surface); 
        color: #0a0e27;
      }
      /* Ensure text is always visible */
      * { color: inherit; }
      p, li, div, span, a, button, input, textarea, select, label { color: #0a0e27; }
      h1, h2, h3, h4, h5, h6 { color: #0a0e27; }
      .layout { display:flex; gap:1rem; align-items:flex-start; max-width:1100px; margin:1.25rem auto; padding:0 1rem; }
      aside { min-width:220px; }
      /* Mobile-specific styles have been removed to force desktop layout
         across all screen sizes. This keeps the main (desktop) version
         intact and avoids alternate mobile styling. */
      /* small adjustments for lists/buttons */
      main ul { padding-left: 0; }
      .card { 
        background:var(--card-bg); 
        border-radius:8px; 
        padding:14px; 
        box-shadow:0 6px 18px rgba(2,6,23,0.06); 
        margin-bottom:14px; 
        transition:transform .14s ease, box-shadow .14s ease; 
        border:1px solid rgba(0,0,0,0.03);
      }
      .card:hover{ 
        transform:translateY(-2px); 
        box-shadow:0 12px 28px rgba(2,6,23,0.1); 
      }
      .actions { display:flex; gap:6px; }
      .actions a, .actions button { margin-right:0; text-decoration:none; }
      .btn { 
        display:inline-block; 
        padding:7px 12px; 
        border-radius:6px; 
        border:0; 
        cursor:pointer; 
        font-weight:600; 
        font-size:0.95rem;
        transition:all .2s ease;
      }
      .btn:hover { 
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }
      .btn-primary{ 
        background:var(--accent); 
        color:#fff; 
      }
      .btn-primary:hover {
        background: #1d4ed8;
      }
      .btn-outline{ 
        background:transparent; 
        color:var(--accent); 
        border:1px solid rgba(37,99,235,0.2);
      }
      .btn-outline:hover {
        background: rgba(37,99,235,0.06);
        border-color: rgba(37,99,235,0.4);
      }
      .btn-danger{ 
        background:#ef4444; 
        color:#fff; 
      }
      .btn-danger:hover {
        background: #dc2626;
      }
      form label { display:block; margin-bottom:0.5rem; font-weight: 600; }
      input[type="text"], input[type="email"], input[type="date"], input[type="number"], textarea { width:100%; box-sizing:border-box; }
      .small-icon{ margin-right:6px; }
      .sidebar-link{ 
        display:block; 
        padding:8px 6px; 
        color:var(--accent); 
        border-radius:6px; 
        font-weight:bold; 
        color: #2563eb !important;
      }
      .sidebar-link:hover{ 
        background:rgba(37,99,235,0.06); 
      }
      /* Progress bar */
      .progress {
        position: relative;
        height: 10px;
        background: #e6eefc;
        border-radius: 6px;
        overflow: hidden;
        width: 140px;
        display:inline-block;
        vertical-align:middle;
        animation: slideIn .4s ease-out;
      }
      .progress > .bar {
        height:100%;
        background: var(--accent);
        width:0%;
        transition: width .4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      .progress.complete > .bar { 
        background: #16a34a;
        box-shadow: 0 0 12px rgba(22, 163, 74, 0.4);
      }
      .progress .badge {
        position: absolute;
        right: 6px;
        top: 50%;
        transform: translateY(-50%);
        background: #16a34a;
        color: #fff;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        animation: popIn .3s cubic-bezier(0.68, -0.55, 0.265, 1.55) .2s both;
      }
      .progress .label {
        position:absolute;
        left:50%;
        top:50%;
        transform:translate(-50%,-50%);
        font-size:0.85rem;
        font-weight:700;
        z-index:1;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          width: 0%;
        }
        to {
          opacity: 1;
          width: 100%;
        }
      }
      @keyframes popIn {
        0% {
          opacity: 0;
          transform: translateY(-50%) scale(0.6);
        }
        100% {
          opacity: 1;
          transform: translateY(-50%) scale(1);
        }
      }
      /* Tooltip styles */
      [data-tooltip] {
        position: relative;
      }
      [data-tooltip]::before {
        content: attr(data-tooltip);
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%) translateY(-4px);
        background: #1f2937;
        color: #fff;
        padding: 6px 10px;
        border-radius: 4px;
        font-size: 0.85rem;
        white-space: nowrap;
        pointer-events: none;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s, visibility .2s, transform .2s;
        z-index: 999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }
      [data-tooltip]::after {
        content: '';
        position: absolute;
        bottom: calc(100% + 2px);
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #1f2937;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s, visibility .2s;
        z-index: 999;
      }
      [data-tooltip]:hover::before,
      [data-tooltip]:hover::after {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0);
      }
      /* Page fade-in animation */
      main {
        animation: pageIn .4s ease-out;
      }
      @keyframes pageIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
      <div style="position:fixed; inset:0; z-index:-1; background-color: var(--surface);"></div>

    <div class="layout">
      <aside>
        <h2>Menu</h2>
        <button id="menu-toggle" aria-expanded="false" aria-controls="main-nav" style="display:none;">☰ Menu</button>
        <nav id="main-nav">
          <ul style="list-style:none; padding:0;">
            <li><a class="sidebar-link" href="{{ url_for('index') }}">Início</a></li>
            <li><a class="sidebar-link" href="{{ url_for('activities_list') }}">Registrar Atividades</a></li>
            <li><a class="sidebar-link" href="{{ url_for('productions_list') }}">Registrar Produções</a></li>
          </ul>
        </nav>
        {% if activities_progress %}
          <div style="margin-top:14px; padding-top:12px; border-top:1px solid rgba(0,0,0,0.06);">
            <h3 style="margin:0 0 10px 0; font-size:0.95rem; display:flex; align-items:center;">
              <i class="fa fa-chart-line" style="margin-right:6px; color:var(--accent);"></i>Progresso
            </h3>
            <ul style="list-style:none; padding:0; margin:0;">
              {% for a in activities_progress %}
                {% set pct = a.percent or (0 if a.goal_points else None) %}
                <li style="padding:8px 0; display:flex; justify-content:space-between; align-items:center; gap:8px;">
                  <a class="sidebar-link" href="{{ url_for('activities_show', id=a.id) }}" style="padding:4px 6px; flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;" title="{{ a.name }}">{{ a.name }}</a>
                  <span style="font-size:0.8rem; font-weight:700; color:#fff; background:{% if pct and pct >= 100 %}#16a34a{% elif pct and pct >= 50 %}var(--accent){% else %}#6b7280{% endif %}; padding:2px 6px; border-radius:3px; min-width:40px; text-align:center;">{% if pct is not none %}{{ pct }}%{% else %}—{% endif %}</span>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </aside>

      <section style="flex:1;">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div style="padding:12px; background:#d4edda; border:1px solid #c3e6cb; border-radius:6px; margin-bottom:12px; color:#155724;">
              {% for msg in messages %}
                <div>✓ {{ msg }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <main>
          {% block content %}{% endblock %}
        </main>
      </section>
    </div>
    <script src="{{ url_for('static', filename='lib/tom-select.complete.min.js') }}"></script>
    <script>
      // Toggle menu on small screens
      (function(){
        var btn = document.getElementById('menu-toggle');
        var aside = document.querySelector('aside');
        var nav = document.getElementById('main-nav');
        if(!btn || !aside || !nav) return;
        function updateVisibility(){
          // Mobile behavior disabled: always show desktop navigation
          var small = false;
          if(small){
            btn.style.display = 'inline-block';
            // hide nav by default on small devices unless toggled
            if(!aside.classList.contains('nav-open')){
              nav.style.display = 'none';
              btn.setAttribute('aria-expanded','false');
            }
          } else {
            btn.style.display = 'none';
            nav.style.display = '';
            aside.classList.remove('nav-open');
            btn.setAttribute('aria-expanded','false');
          }
        }
        btn.addEventListener('click', function(){
          var open = aside.classList.toggle('nav-open');
          nav.style.display = open ? 'block' : 'none';
          btn.setAttribute('aria-expanded', open ? 'true' : 'false');
        });
        window.addEventListener('resize', updateVisibility);
        // initial
        updateVisibility();
      })();
      // Initialize Tom Select on activity dropdowns (if present)
      (function(){
        try {
          var selects = document.querySelectorAll('select[name="activity_id"].tom-select');
          selects.forEach(function(s){
            if (!s.tomselect) {
              new TomSelect(s, {
                create: false,
                sortField: { field: "text", direction: "asc" },
                placeholder: s.dataset.placeholder || 'Pesquisar atividade...'
              });
            }
          });
        } catch(e){
          // ignore if Tom Select not available
          console.warn('Tom Select init error', e);
        }
      })();

      // Simple client-side validation for required fields and integer quantity
      (function(){
        function isIntValue(v){ if(v===undefined||v==='') return true; return /^\d+$/.test(v); }
        var forms = document.querySelectorAll('form');
        forms.forEach(function(form){
          form.addEventListener('submit', function(ev){
            var ok = true;
            var reqs = form.querySelectorAll('[required]');
            reqs.forEach(function(inp){ if(!inp.value || String(inp.value).trim()==='') ok = false; });
            // check quantity inputs
            var qty = form.querySelector('input[name="quantity"]');
            if(qty && !isIntValue(qty.value)) ok = false;
            if(!ok){ ev.preventDefault(); alert('Por favor preencha os campos obrigatórios corretamente.'); }
          });
        });
      })();
    </script>
  </body>
</html>
